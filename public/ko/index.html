<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>goUP URL</title>
    <meta name='description' content='100% 무료 로그인이 필요없는 URL 단축기'>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <iframe src="/lang.html" style="border: none; width: 100%; height: 20px;"></iframe>

    <header>
        <nav>
          <div class="hamburger" onclick="toggleMenu()">
            <div class="bar"></div>
            <div class="bar"></div>
            <div class="bar"></div>
          </div>
          <ul id="menu">
            <li><a href="https://goup.im/ko">goUP</a></li>
            <select_items><li><a href="/ko/index.html">URL</a></li></select_items>
            <li><a href="https://id.goup.im">ID</a></li>
            <li><a href="https://ai.goup.im">AI</a></li>
          </ul>
        </nav>
      </header>

    <h2>goUP URL</h2>
    <div class="container">
        <div class="input-container">
            <input type="text" id="urlInput" placeholder="단축할 URL 주소를 입력하세요">
            <button onclick="shortenUrl()">단축</button>
        </div>
        <div id="result"></div>
        <div class="table-container" id="tableContainer">
            <table id="urlTable">
                <thead>
                    <tr>
                        <!--<th>원본 URL</th>-->
                        <th>단축된 URL</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- 단축된 URL이 여기에 삽입됩니다 -->
                </tbody>
            </table>
        </div>
    </div>
    <div class="email">문의: goup@goup.im</div>
    <div class="email">goUP URL 2.0 - 한국어 페이지</div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            loadUrls(); // 페이지 로드 시 URL 목록 로드
        });

        async function shortenUrl() {
            const url = document.getElementById('urlInput').value;
            if (!isValidURL(url)) {
                alert("유효한 URL을 입력하세요.");
                return;
            }
            const response = await fetch('/shorten', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ url })
            });
            
            if (!response.ok) {
                alert("유효한 URL을 입력하세요.");
                return;
            }

            const data = await response.json();
            const resultDiv = document.getElementById('result');
            const shortUrl = `https://url.goup.im/${data.shortUrl}`;
            saveUrl(url, shortUrl);
            addUrlToTable(url, shortUrl);
            document.getElementById('urlInput').value = '';
        }

        function isValidURL(url) {
            const pattern = new RegExp('^(https?:\\/\\/)?'+ // 프로토콜
                '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.?)+[a-z]{2,}|'+ // 도메인 이름
                '((\\d{1,3}\\.){3}\\d{1,3}))'+ // 또는 IP (v4) 주소
                '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*'+ // 포트와 경로
                '(\\?[;&a-z\\d%_.~+=-]*)?'+ // 쿼리 문자열
                '(\\#[-a-z\\d_]*)?$','i'); // 프래그먼트 로케이터
            return !!pattern.test(url);
        }

        function saveUrl(originalUrl, shortUrl) {
            let urls = JSON.parse(localStorage.getItem('urls')) || [];
            urls.push({ originalUrl, shortUrl });
            localStorage.setItem('urls', JSON.stringify(urls));
        }

        function loadUrls() {
            const urls = JSON.parse(localStorage.getItem('urls')) || [];
            const tableContainer = document.getElementById('tableContainer');
            const tableBody = document.querySelector('#urlTable tbody');
            tableBody.innerHTML = '';
            if (urls.length > 0) {
                tableContainer.style.display = 'block';
                urls.forEach(url => addUrlToTable(url.originalUrl, url.shortUrl));
            } else {
                tableContainer.style.display = 'none';
            }
        }

        function addUrlToTable(originalUrl, shortUrl) {
            const tableBody = document.querySelector('#urlTable tbody');
            const row = document.createElement('tr');
            row.innerHTML = `
                <!--<td><a href="${originalUrl}" target="_blank">${originalUrl}</a></td>-->
                <td><a href="${shortUrl}" target="_blank">${shortUrl}</a></td>
            `;
            tableBody.appendChild(row);
            const tableContainer = document.getElementById('tableContainer');
            tableContainer.style.display = 'block';
        }
    </script>
</body>
</html>